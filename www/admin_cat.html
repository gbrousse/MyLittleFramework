<?php
    $currentCat = $view->getOption('cat');
?>
    <main role="main" class="container">
        <h1 class="mt-5">Catégorie</h1>
        <?php if(isset($view->options['formError'])){ ?>
        <div class="alert alert-danger" role="alert">
            <strong>Oups!</strong> <?php echo $view->options['formError']; ?>
        </div>
        <?php } ?>
        <?php if(isset($view->options['formSuccess'])){ ?>
        <div class="alert alert-success" role="alert">
            Modifications enregistrées
        </div>
        <?php } ?>
        <form method="post">
            <div class="form-group row">
                <label for="name" class="col-3 col-form-label">Nom de la catégorie</label>
                <div class="col-9">
                    <input type="text" class="form-control" name="name" id="login" placeholder="Nom de la catégorie" value="<?php echo $currentCat->getname(); ?>" >
                </div>
            </div>
            
            <div class="form-group row">
                <label for="parent" class="col-3 col-form-label">Catégorie mère</label>
                <div class="col-9">
                    <select class="custom-select" id="parent" name="parent">
                        <option>Catégories</option>
                        <?php foreach ($view->getOption('categories')->getElements() as $cat) { 
                            $parent =  $currentCat->getParent();
                            if(is_null($parent)){
                                $parentId = -1;
                            }else{
                                $parentId = $parent->getId();
                            }
                            showCat($cat,'',$parentId);
                        } ?>
                    </select>
                </div>
            </div> 
            <button type="submit" class="btn btn-primary">Enregistrer</button>
			<a class="btn btn-secondary" href="<?php $view->services->router->getPath(array('admin','categories'),array());?>">Retour</button>
        </form>
    </main>
<?php
function showCat ($cat, $title,$parent){
    $hasSub = false;
    $title .= (($title=='')?'':' - ').$cat->getName();
    if($childs = $cat->getChilds()){
        if($childs instanceof \Core\models\CategoriesCollection)$hasSub = true;
    }
    ?>
<option value="<?php echo $cat->getId(); ?>" <?php echo ($cat->getId() == $parent)?'selected':'';?>><?php echo $title; ?></option>
        <?php if($hasSub){ ?>
            <?php foreach($childs->getElements() as $child){
                showCat($child,$title,$parent);
            } ?>
        <?php } ?>
    </li>
    <?php
}
?>